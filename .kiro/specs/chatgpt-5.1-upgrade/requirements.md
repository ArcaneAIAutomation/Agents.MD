# ChatGPT-5.1 Upgrade Requirements

## Introduction

This specification defines the requirements for upgrading the AI Trade Generation Engine (ATGE) and other AI-powered features from GPT-4o to ChatGPT-5.1 (gpt-chatgpt-5.1-latest). ChatGPT-5.1 is OpenAI's latest model with improved reasoning, better instruction following, and enhanced JSON output reliability.

## Glossary

- **ChatGPT-5.1**: OpenAI's latest model (gpt-chatgpt-5.1-latest) with improved reasoning and reliability
- **GPT-4o**: Previous OpenAI model (gpt-4o-2024-08-06) currently in use
- **ATGE**: AI Trade Generation Engine - generates cryptocurrency trading signals
- **Model Version**: The specific OpenAI model identifier used for API calls
- **Fallback Model**: Secondary model used if primary model fails (Gemini AI)

---

## Requirements

### Requirement 1: Model Upgrade Configuration

**User Story:** As a system administrator, I want to upgrade to ChatGPT-5.1 so that the platform benefits from improved AI reasoning and reliability.

#### Acceptance Criteria

1. WHEN configuring the OpenAI model, THE System SHALL use "gpt-chatgpt-5.1-latest" as the model identifier
2. WHEN the environment variable OPENAI_MODEL is set, THE System SHALL use that value for all OpenAI API calls
3. WHEN the environment variable OPENAI_MODEL is not set, THE System SHALL default to "gpt-chatgpt-5.1-latest"
4. WHEN storing trade signals, THE System SHALL record the actual model version used (e.g., "gpt-chatgpt-5.1-latest")
5. WHEN displaying trade history, THE System SHALL show which model version generated each trade

---

### Requirement 2: ATGE Trade Signal Generation Upgrade

**User Story:** As a trader, I want trade signals generated by ChatGPT-5.1 so that I receive more accurate and reliable trading recommendations.

#### Acceptance Criteria

1. WHEN generating a trade signal, THE ATGE SHALL use ChatGPT-5.1 as the primary AI model
2. WHEN ChatGPT-5.1 is unavailable, THE ATGE SHALL fall back to Gemini AI
3. WHEN calling the OpenAI API, THE ATGE SHALL use the model identifier from OPENAI_MODEL environment variable
4. WHEN generating a trade signal, THE ATGE SHALL maintain the same prompt structure and JSON output format
5. WHEN a trade signal is generated, THE ATGE SHALL store "gpt-chatgpt-5.1-latest" as the aiModelVersion
6. WHEN viewing trade details, THE System SHALL display the model version that generated the trade

---

### Requirement 3: Environment Variable Configuration

**User Story:** As a developer, I want to easily configure the OpenAI model version so that I can test different models or roll back if needed.

#### Acceptance Criteria

1. WHEN deploying to production, THE System SHALL read OPENAI_MODEL from environment variables
2. WHEN OPENAI_MODEL is set to "gpt-chatgpt-5.1-latest", THE System SHALL use ChatGPT-5.1
3. WHEN OPENAI_MODEL is set to "gpt-4o", THE System SHALL use GPT-4o (for rollback capability)
4. WHEN OPENAI_MODEL is not set, THE System SHALL default to "gpt-chatgpt-5.1-latest"
5. WHEN the model is changed, THE System SHALL not require code changes, only environment variable updates

---

### Requirement 4: Backward Compatibility

**User Story:** As a system administrator, I want the ability to roll back to GPT-4o if ChatGPT-5.1 has issues so that the platform remains operational.

#### Acceptance Criteria

1. WHEN OPENAI_MODEL is set to "gpt-4o", THE System SHALL continue to function with GPT-4o
2. WHEN viewing historical trades, THE System SHALL correctly display trades generated by both GPT-4o and ChatGPT-5.1
3. WHEN filtering trades by model version, THE System SHALL support filtering by "gpt-4o" or "gpt-chatgpt-5.1-latest"
4. WHEN comparing performance, THE System SHALL allow comparison between GPT-4o and ChatGPT-5.1 generated trades

---

### Requirement 5: Documentation Updates

**User Story:** As a developer, I want updated documentation so that I understand how to configure and use ChatGPT-5.1.

#### Acceptance Criteria

1. WHEN reading the README, THE Documentation SHALL mention ChatGPT-5.1 as the primary AI model
2. WHEN reading the API documentation, THE Documentation SHALL list "gpt-chatgpt-5.1-latest" as the model identifier
3. WHEN reading the environment variable guide, THE Documentation SHALL explain OPENAI_MODEL configuration
4. WHEN reading the ATGE documentation, THE Documentation SHALL reference ChatGPT-5.1 instead of GPT-4o
5. WHEN reading the steering files, THE Documentation SHALL be updated to reflect ChatGPT-5.1 usage

---

### Requirement 6: Testing and Validation

**User Story:** As a QA engineer, I want to verify that ChatGPT-5.1 generates valid trade signals so that users receive reliable trading recommendations.

#### Acceptance Criteria

1. WHEN generating a test trade signal, THE System SHALL successfully call ChatGPT-5.1 API
2. WHEN ChatGPT-5.1 returns a response, THE System SHALL validate the JSON structure
3. WHEN the JSON is valid, THE System SHALL store the trade signal in the database
4. WHEN viewing the trade signal, THE System SHALL display all fields correctly
5. WHEN comparing with GPT-4o, THE System SHALL demonstrate similar or improved signal quality

---

### Requirement 7: Performance Monitoring

**User Story:** As a system administrator, I want to monitor ChatGPT-5.1 performance so that I can identify any issues or improvements.

#### Acceptance Criteria

1. WHEN a trade signal is generated, THE System SHALL log the model version used
2. WHEN a trade signal is generated, THE System SHALL log the API response time
3. WHEN a trade signal fails, THE System SHALL log the error and model version
4. WHEN viewing performance metrics, THE System SHALL show success rates by model version
5. WHEN viewing performance metrics, THE System SHALL show average response times by model version

---

## Files to Update

### Code Files
1. `lib/atge/aiGenerator.ts` - Update model identifier to use OPENAI_MODEL env var
2. `pages/api/atge/generate.ts` - Ensure model version is stored correctly
3. `.env.local` - Update OPENAI_MODEL to "gpt-chatgpt-5.1-latest"

### Documentation Files
1. `.kiro/specs/ai-trade-generation-engine/requirements.md` - Update references to ChatGPT-5.1
2. `.kiro/specs/ai-trade-generation-engine/design.md` - Update architecture diagrams
3. `ATGE-TRADE-CALCULATION-FLOW.md` - Update AI model references
4. `AI-SETUP-GUIDE.md` - Update model configuration instructions
5. `.kiro/steering/ucie-system.md` - Update AI model references
6. `.kiro/steering/api-integration.md` - Update OpenAI integration details

---

## Success Criteria

The upgrade is considered successful when:

1. ✅ All ATGE trade signals are generated using ChatGPT-5.1
2. ✅ Trade signals maintain the same quality and structure as GPT-4o
3. ✅ Model version is correctly stored and displayed in the database
4. ✅ Fallback to Gemini AI still works if ChatGPT-5.1 fails
5. ✅ Environment variable configuration allows easy model switching
6. ✅ All documentation is updated to reflect ChatGPT-5.1 usage
7. ✅ Performance metrics show successful API calls and valid responses

---

## Non-Functional Requirements

### Performance
- ChatGPT-5.1 API calls should complete within 10 seconds (similar to GPT-4o)
- No degradation in trade signal generation speed

### Reliability
- ChatGPT-5.1 should have ≥95% success rate for valid JSON responses
- Fallback to Gemini AI should activate within 2 seconds of ChatGPT-5.1 failure

### Maintainability
- Model version should be configurable via environment variable only
- No hardcoded model identifiers in code (except defaults)

---

## Risks and Mitigations

### Risk 1: ChatGPT-5.1 API Changes
**Mitigation**: Maintain GPT-4o as rollback option via OPENAI_MODEL env var

### Risk 2: Different JSON Output Format
**Mitigation**: Extensive testing with JSON validation and repair logic

### Risk 3: Increased API Costs
**Mitigation**: Monitor usage and costs, implement rate limiting if needed

### Risk 4: Performance Degradation
**Mitigation**: Track response times and compare with GPT-4o baseline

---

## References

- OpenAI ChatGPT-5.1 Documentation: https://platform.openai.com/docs/guides/latest-model
- Current ATGE Implementation: `lib/atge/aiGenerator.ts`
- ATGE Requirements: `.kiro/specs/ai-trade-generation-engine/requirements.md`
