# GPT-5.1 Model Upgrade Requirements

## Introduction

This specification defines the requirements for upgrading all OpenAI integrations across the entire platform to use the latest GPT-5.1 model via the Responses API. GPT-5.1 is OpenAI's latest reasoning model that replaces GPT-5, o3, and o4-mini, featuring:

- **Advanced Reasoning**: Chain of thought (CoT) reasoning with configurable effort levels
- **Reasoning Effort Control**: none (fastest), low, medium, high (most thorough)
- **Verbosity Control**: low (concise), medium (default), high (detailed)
- **Responses API**: New API format with reasoning output and CoT passing
- **Custom Tools**: Support for apply_patch, shell, and custom tools
- **Improved Performance**: Better reasoning capabilities than previous models
- **Fallback Support**: Automatic fallback to gpt-5-mini if primary model fails

This upgrade affects ALL OpenAI integration points across the platform:
- AI Trade Generation Engine (ATGE)
- UCIE (Universal Crypto Intelligence Engine)
- Whale Watch Deep Dive Analysis
- Comprehensive AI Analysis
- Trade Analyzer

## Glossary

- **gpt-5.1**: OpenAI's latest reasoning model via Responses API (replaces GPT-5, o3, o4-mini)
- **gpt-5-mini**: Fallback model for when gpt-5.1 fails or times out
- **Responses API**: New OpenAI API format (openai.responses.create) with reasoning output
- **Reasoning Effort**: Configurable reasoning depth (none, low, medium, high)
- **Verbosity**: Output detail level (low, medium, high)
- **Chain of Thought (CoT)**: Reasoning process that can be passed between API turns
- **ATGE**: AI Trade Generation Engine - generates cryptocurrency trading signals
- **UCIE**: Universal Crypto Intelligence Engine - comprehensive market analysis
- **Model Version**: The specific OpenAI model identifier used for API calls
- **Fallback Model**: Secondary model used if primary model fails (gpt-5-mini, then Gemini AI)

---

## Requirements

### Requirement 1: Model Upgrade Configuration

**User Story:** As a system administrator, I want to upgrade to chatgpt-4o-latest across ALL OpenAI integrations so that the entire platform benefits from the latest AI capabilities and automatic model updates.

#### Acceptance Criteria

1. WHEN configuring the OpenAI model, THE System SHALL use "gpt-5.1" as the default model identifier
2. WHEN the environment variable OPENAI_MODEL is set, THE System SHALL use that value for all OpenAI API calls across ALL modules
3. WHEN the environment variable OPENAI_MODEL is not set, THE System SHALL default to "gpt-5.1"
4. WHEN the environment variable REASONING_EFFORT is set, THE System SHALL use that reasoning level (none, low, medium, high)
5. WHEN the environment variable VERBOSITY is set, THE System SHALL use that verbosity level (low, medium, high)
6. WHEN storing analysis results, THE System SHALL record the actual model version returned by the API
7. WHEN displaying analysis history, THE System SHALL show which specific model version generated each result
8. WHEN the model is upgraded, THE System SHALL automatically use the latest version without code changes

---

### Requirement 2: ATGE Trade Signal Generation Upgrade

**User Story:** As a trader, I want trade signals generated by gpt-5.1 so that I receive the most accurate and up-to-date trading recommendations with advanced reasoning.

#### Acceptance Criteria

1. WHEN generating a trade signal, THE ATGE SHALL use gpt-5.1 via Responses API as the primary AI model
2. WHEN the primary model times out (>120 seconds), THE ATGE SHALL fall back to gpt-5-mini, then Gemini AI
3. WHEN calling the OpenAI API, THE ATGE SHALL use the model identifier from OPENAI_MODEL environment variable
4. WHEN calling the OpenAI API, THE ATGE SHALL use reasoning effort from REASONING_EFFORT environment variable
5. WHEN generating a trade signal, THE ATGE SHALL maintain the same prompt structure and JSON output format
6. WHEN a trade signal is generated, THE ATGE SHALL store the actual model version returned by the API
7. WHEN reasoning output is available, THE ATGE SHALL include it in the analysis
8. WHEN viewing trade details, THE System SHALL display the specific model version that generated the trade
9. WHEN a timeout occurs, THE System SHALL log the timeout event with model version and duration
10. WHEN the API returns an error, THE System SHALL log the error with model version for debugging

---

### Requirement 3: Environment Variable Configuration

**User Story:** As a developer, I want to easily configure the OpenAI model version and reasoning parameters so that I can test different models or adjust performance.

#### Acceptance Criteria

1. WHEN deploying to production, THE System SHALL read OPENAI_MODEL from environment variables
2. WHEN OPENAI_MODEL is set to "gpt-5.1", THE System SHALL use the latest GPT-5.1 model via Responses API
3. WHEN OPENAI_MODEL is set to "gpt-5-mini", THE System SHALL use the fallback model
4. WHEN OPENAI_MODEL is not set, THE System SHALL default to "gpt-5.1"
5. WHEN REASONING_EFFORT is set, THE System SHALL use that reasoning level (none, low, medium, high)
6. WHEN VERBOSITY is set, THE System SHALL use that verbosity level (low, medium, high)
7. WHEN the model is changed, THE System SHALL not require code changes, only environment variable updates
8. WHEN using gpt-5.1, THE System SHALL automatically benefit from OpenAI's model updates

---

### Requirement 4: Backward Compatibility

**User Story:** As a system administrator, I want the ability to roll back to gpt-5-mini if gpt-5.1 has issues so that the platform remains operational.

#### Acceptance Criteria

1. WHEN OPENAI_MODEL is set to "gpt-5-mini", THE System SHALL continue to function with the fallback model
2. WHEN viewing historical analysis, THE System SHALL correctly display results generated by all model versions
3. WHEN filtering analysis by model version, THE System SHALL support filtering by any model identifier
4. WHEN comparing performance, THE System SHALL allow comparison between different model versions
5. WHEN rolling back, THE System SHALL maintain all existing functionality without code changes
6. WHEN gpt-5.1 fails, THE System SHALL automatically fall back to gpt-5-mini, then Gemini AI

---

### Requirement 5: UCIE OpenAI Client Upgrade

**User Story:** As a user, I want UCIE analysis powered by chatgpt-4o-latest so that I receive the most comprehensive and accurate market intelligence.

#### Acceptance Criteria

1. WHEN generating UCIE analysis, THE System SHALL use chatgpt-4o-latest as the primary AI model
2. WHEN calling the OpenAI API, THE UCIE SHALL use the model identifier from OPENAI_MODEL environment variable
3. WHEN analysis is generated, THE System SHALL store the actual model version returned by the API
4. WHEN displaying analysis results, THE System SHALL show which model version generated the analysis
5. WHEN the API times out (>120 seconds), THE System SHALL log the timeout and retry once
6. WHEN retries fail, THE System SHALL return a clear error message to the user

---

### Requirement 6: Whale Watch Deep Dive Upgrade

**User Story:** As a whale watcher, I want deep dive analysis powered by chatgpt-4o-latest so that I receive the most sophisticated transaction intelligence.

#### Acceptance Criteria

1. WHEN performing deep dive analysis, THE System SHALL use chatgpt-4o-latest as the AI model
2. WHEN calling the OpenAI API, THE Whale Watch SHALL use the model identifier from OPENAI_MODEL environment variable
3. WHEN analysis is generated, THE System SHALL store the actual model version in the response metadata
4. WHEN displaying deep dive results, THE System SHALL show which model version generated the analysis
5. WHEN the API times out (>15 seconds), THE System SHALL return a timeout error with retry suggestion
6. WHEN blockchain data is unavailable, THE System SHALL return a clear error message

---

### Requirement 7: Comprehensive AI Analysis Upgrade

**User Story:** As a trader, I want comprehensive AI analysis powered by chatgpt-4o-latest so that I receive the most detailed multi-source market analysis.

#### Acceptance Criteria

1. WHEN generating comprehensive analysis, THE System SHALL use chatgpt-4o-latest as the primary AI model
2. WHEN calling the OpenAI API, THE System SHALL use the model identifier from OPENAI_MODEL environment variable
3. WHEN analysis is generated, THE System SHALL track which AI models were used (OpenAI primary, Gemini fallback)
4. WHEN displaying analysis results, THE System SHALL show all AI models used in the analysis
5. WHEN OpenAI times out (>120 seconds), THE System SHALL fall back to Gemini AI
6. WHEN both AI models fail, THE System SHALL return technical analysis only with clear error message

---

### Requirement 8: AI Trade Analyzer Upgrade

**User Story:** As a trader, I want trade analysis powered by chatgpt-4o-latest so that I receive the most insightful post-trade analysis.

#### Acceptance Criteria

1. WHEN analyzing completed trades, THE System SHALL use chatgpt-4o-latest as the AI model
2. WHEN calling the OpenAI API, THE Analyzer SHALL use the model identifier from OPENAI_MODEL environment variable
3. WHEN analysis is generated, THE System SHALL store the actual model version used
4. WHEN displaying trade analysis, THE System SHALL show which model version generated the insights
5. WHEN the API fails, THE System SHALL return a fallback analysis with clear indication
6. WHEN analyzing trade patterns, THE System SHALL use the same model for consistency

---

### Requirement 9: Documentation Updates

**User Story:** As a developer, I want updated documentation so that I understand how to configure and use chatgpt-4o-latest across all platform features.

#### Acceptance Criteria

1. WHEN reading the README, THE Documentation SHALL mention chatgpt-4o-latest as the primary AI model
2. WHEN reading the API documentation, THE Documentation SHALL list "chatgpt-4o-latest" as the model identifier
3. WHEN reading the environment variable guide, THE Documentation SHALL explain OPENAI_MODEL configuration
4. WHEN reading the ATGE documentation, THE Documentation SHALL reference chatgpt-4o-latest
5. WHEN reading the UCIE documentation, THE Documentation SHALL reference chatgpt-4o-latest
6. WHEN reading the Whale Watch documentation, THE Documentation SHALL reference chatgpt-4o-latest
7. WHEN reading the steering files, THE Documentation SHALL be updated to reflect chatgpt-4o-latest usage across all features

---

### Requirement 10: Testing and Validation

**User Story:** As a QA engineer, I want to verify that chatgpt-4o-latest generates valid outputs across all platform features so that users receive reliable AI-powered analysis.

#### Acceptance Criteria

1. WHEN generating ATGE trade signals, THE System SHALL successfully call chatgpt-4o-latest API and validate JSON structure
2. WHEN generating UCIE analysis, THE System SHALL successfully call chatgpt-4o-latest API and validate response format
3. WHEN performing Whale Watch deep dive, THE System SHALL successfully call chatgpt-4o-latest API and validate analysis structure
4. WHEN generating comprehensive analysis, THE System SHALL successfully call chatgpt-4o-latest API and validate multi-source integration
5. WHEN analyzing trades, THE System SHALL successfully call chatgpt-4o-latest API and validate insights structure
6. WHEN comparing with gpt-4o, THE System SHALL demonstrate similar or improved output quality across all features
7. WHEN storing results, THE System SHALL correctly record the actual model version returned by the API

---

### Requirement 11: Performance Monitoring

**User Story:** As a system administrator, I want to monitor chatgpt-4o-latest performance across all platform features so that I can identify any issues or improvements.

#### Acceptance Criteria

1. WHEN any AI analysis is generated, THE System SHALL log the model version used
2. WHEN any AI analysis is generated, THE System SHALL log the API response time
3. WHEN any AI analysis fails, THE System SHALL log the error, model version, and failure reason
4. WHEN viewing performance metrics, THE System SHALL show success rates by model version for each feature
5. WHEN viewing performance metrics, THE System SHALL show average response times by model version for each feature
6. WHEN viewing performance metrics, THE System SHALL show cost analysis by model version
7. WHEN performance degrades, THE System SHALL alert administrators with specific metrics

---

## Files to Update

### Code Files (OpenAI Integration Points)
1. `lib/atge/aiGenerator.ts` - Update model from 'gpt-chatgpt-5.1-mini' to 'chatgpt-4o-latest'
2. `lib/atge/comprehensiveAIAnalysis.ts` - Update model from 'gpt-chatgpt-5.1-mini' to 'chatgpt-4o-latest'
3. `lib/atge/aiAnalyzer.ts` - Update model from 'gpt-chatgpt-5.1-mini' to 'chatgpt-4o-latest'
4. `lib/ucie/openaiClient.ts` - Update model from 'gpt-chatgpt-5.1-mini' to 'chatgpt-4o-latest'
5. `pages/api/whale-watch/deep-dive-openai.ts` - Update model from 'gpt-4o' to 'chatgpt-4o-latest'

### Environment Configuration Files
6. `.env.local` - Update OPENAI_MODEL="chatgpt-4o-latest"
7. `.env.example` - Update OPENAI_MODEL configuration with chatgpt-4o-latest documentation
8. `vercel.json` - Verify environment variable configuration (if needed)

### Documentation Files - ATGE
9. `.kiro/specs/ai-trade-generation-engine/requirements.md` - Update all references to chatgpt-4o-latest
10. `.kiro/specs/ai-trade-generation-engine/design.md` - Update architecture diagrams and model references
11. `ATGE-TRADE-CALCULATION-FLOW.md` - Update AI model references throughout
12. `AI-SETUP-GUIDE.md` - Update model configuration instructions

### Documentation Files - UCIE
13. `.kiro/specs/ucie-veritas-protocol/requirements.md` - Update GPT-4o references to chatgpt-4o-latest
14. `.kiro/specs/ucie-veritas-protocol/tasks.md` - Update GPT-4o references to chatgpt-4o-latest
15. `.kiro/steering/ucie-system.md` - Update AI model references and execution order documentation
16. `.kiro/steering/api-integration.md` - Update OpenAI integration details

### Documentation Files - Whale Watch
17. `WHALE-WATCH-FIX-SUMMARY.md` - Update model references (if exists)
18. Any Whale Watch specific documentation - Update to chatgpt-4o-latest

### Documentation Files - General
19. `README.md` - Update AI model references in main documentation
20. `KIRO-AGENT-STEERING.md` - Update AI model references in agent steering
21. `.kiro/steering/KIRO-AGENT-STEERING.md` - Update AI model references
22. `tech.md` - Update technology stack documentation
23. `product.md` - Update product overview with latest AI capabilities

### Spec Files (This Upgrade)
24. `.kiro/specs/chatgpt-5.1-upgrade/requirements.md` - This file (update title and content)
25. `.kiro/specs/chatgpt-5.1-upgrade/design.md` - Update design document
26. `.kiro/specs/chatgpt-5.1-upgrade/tasks.md` - Update task list with comprehensive scope

---

## Success Criteria

The upgrade is considered successful when:

1. ✅ ALL OpenAI integration points use chatgpt-4o-latest (5 code files updated)
2. ✅ ATGE trade signals are generated using chatgpt-4o-latest with valid JSON structure
3. ✅ UCIE analysis is generated using chatgpt-4o-latest with comprehensive market intelligence
4. ✅ Whale Watch deep dive uses chatgpt-4o-latest with sophisticated transaction analysis
5. ✅ Comprehensive AI analysis uses chatgpt-4o-latest with multi-source integration
6. ✅ Trade analyzer uses chatgpt-4o-latest with insightful post-trade analysis
7. ✅ Model version is correctly stored and displayed across all features
8. ✅ Fallback to Gemini AI still works if chatgpt-4o-latest fails
9. ✅ Environment variable configuration allows easy model switching
10. ✅ ALL documentation is updated to reflect chatgpt-4o-latest usage (20+ files)
11. ✅ Performance metrics show successful API calls and valid responses across all features
12. ✅ No degradation in response quality or speed compared to previous models
13. ✅ Cost analysis shows acceptable API usage costs
14. ✅ All tests pass for each integration point

---

## Non-Functional Requirements

### Performance
- ChatGPT-5.1 API calls should complete within 10 seconds (similar to GPT-4o)
- No degradation in trade signal generation speed

### Reliability
- ChatGPT-5.1 should have ≥95% success rate for valid JSON responses
- Fallback to Gemini AI should activate within 2 seconds of ChatGPT-5.1 failure

### Maintainability
- Model version should be configurable via environment variable only
- No hardcoded model identifiers in code (except defaults)

---

## Risks and Mitigations

### Risk 1: ChatGPT-5.1 API Changes
**Mitigation**: Maintain GPT-4o as rollback option via OPENAI_MODEL env var

### Risk 2: Different JSON Output Format
**Mitigation**: Extensive testing with JSON validation and repair logic

### Risk 3: Increased API Costs
**Mitigation**: Monitor usage and costs, implement rate limiting if needed

### Risk 4: Performance Degradation
**Mitigation**: Track response times and compare with GPT-4o baseline

---

## References

- OpenAI Latest Model Documentation: https://platform.openai.com/docs/guides/latest-model
- OpenAI Models Overview: https://platform.openai.com/docs/models
- OpenAI API Reference: https://platform.openai.com/docs/api-reference/chat
- Current ATGE Implementation: `lib/atge/aiGenerator.ts`
- Current UCIE Implementation: `lib/ucie/openaiClient.ts`
- Current Whale Watch Implementation: `pages/api/whale-watch/deep-dive-openai.ts`
- ATGE Requirements: `.kiro/specs/ai-trade-generation-engine/requirements.md`
- UCIE Requirements: `.kiro/specs/ucie-veritas-protocol/requirements.md`

## Model Comparison

### chatgpt-4o-latest vs gpt-4o

| Feature | chatgpt-4o-latest | gpt-4o (static) |
|---------|-------------------|-----------------|
| **Model Updates** | Automatic (always latest) | Fixed version (2024-08-06) |
| **Context Window** | 128K tokens | 128K tokens |
| **Input Cost** | $2.50 per 1M tokens | $2.50 per 1M tokens |
| **Output Cost** | $10.00 per 1M tokens | $10.00 per 1M tokens |
| **JSON Mode** | Enhanced reliability | Standard |
| **Reasoning** | Latest improvements | Fixed capabilities |
| **Instruction Following** | Latest improvements | Fixed capabilities |
| **Multimodal** | Text + Vision | Text + Vision |
| **Recommended For** | Production (auto-updates) | Testing (stable version) |

### Benefits of chatgpt-4o-latest

1. **Automatic Updates**: Always uses the latest GPT-4o version without code changes
2. **Improved Capabilities**: Benefits from ongoing model improvements
3. **Better JSON Mode**: More reliable structured output generation
4. **Enhanced Reasoning**: Latest reasoning and problem-solving capabilities
5. **Same Cost**: No additional cost compared to static gpt-4o
6. **Future-Proof**: Automatically adopts future GPT-4o improvements
