# =============================================================================
# AGENTS.MD V2.0 - PRODUCTION ENVIRONMENT VARIABLES
# =============================================================================
# Copy this file to .env.local and fill in your API keys
# For Vercel deployment, add these as environment variables in your dashboard
#
# QUICK START GUIDE:
# 1. Copy this file: cp .env.example .env.local
# 2. Generate secrets: openssl rand -base64 32 (for JWT_SECRET and CRON_SECRET)
# 3. Set up Vercel Postgres: Dashboard > Storage > Create Database > Postgres
# 4. Set up Vercel KV: Dashboard > Storage > Create Database > KV
# 5. Configure Office 365: Use existing Azure AD credentials
# 6. Fill in all REQUIRED variables below
# 7. Deploy to Vercel: vercel --prod
#
# AUTHENTICATION SYSTEM QUICK REFERENCE:
# ========================================
# Required for Authentication:
#   - DATABASE_URL (Vercel Postgres)
#   - JWT_SECRET (Generate with: openssl rand -base64 32)
#   - KV_REST_API_URL (Vercel KV)
#   - KV_REST_API_TOKEN (Vercel KV)
#   - CRON_SECRET (Generate with: openssl rand -base64 32)
#   - SENDER_EMAIL (Office 365 mailbox)
#   - AZURE_TENANT_ID (Azure AD)
#   - AZURE_CLIENT_ID (Azure AD)
#   - AZURE_CLIENT_SECRET (Azure AD)
#
# Optional but Recommended:
#   - JWT_EXPIRATION (default: 7d)
#   - AUTH_RATE_LIMIT_MAX_ATTEMPTS (default: 5)
#   - AUTH_RATE_LIMIT_WINDOW_MS (default: 900000)
#
# For detailed setup instructions, see: docs/DEPLOYMENT.md
# For user documentation, see: docs/USER-GUIDE.md

# =============================================================================
# ü§ñ AI CONFIGURATION
# =============================================================================
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o-2024-08-06

# =============================================================================
# üß† GEMINI AI CONFIGURATION (Whale Watch Analysis)
# =============================================================================
# Get your API key from: https://aistudio.google.com/app/apikey
# Used for: Whale Watch transaction analysis with thinking mode and Deep Dive
# Documentation: See pages/api/whale-watch/analyze-gemini.ts for implementation details

# Gemini API Key (REQUIRED for Whale Watch AI analysis)
# Format: Must start with "AIzaSy" followed by 33 characters
# Example: AIzaSyAbCdEfGhIjKlMnOpQrStUvWxYz1234567
# Validation: API key format is validated on startup
GEMINI_API_KEY=your_gemini_api_key_here

# Model Selection (Optional - defaults to gemini-2.5-flash)
# Options: 
#   - gemini-2.5-flash: Fast analysis (~3 seconds), optimized for speed
#   - gemini-2.5-pro: Deep analysis (~7 seconds), comprehensive insights
# 
# Automatic Selection Logic:
#   - Transactions < 100 BTC: Uses gemini-2.5-flash (cost-effective)
#   - Transactions >= 100 BTC: Uses gemini-2.5-pro (Deep Dive enabled)
#   - User can override via API request parameter
# 
# Cost Estimates (per analysis, as of January 2025):
#   - Flash: ~$0.0001 (input + output tokens)
#   - Pro: ~$0.0005 (input + output tokens)
#   - Deep Dive: ~$0.002 (extended context + blockchain data)
GEMINI_MODEL=gemini-2.5-flash

# Thinking Mode (Optional - defaults to true)
# Enable to see AI's step-by-step reasoning process in analysis
# When enabled:
#   - Shows AI's thought process in collapsible "AI Reasoning Process" section
#   - Adds system instruction to model for transparent reasoning
#   - Increases response time by ~10-20%
#   - Helps users understand how AI arrived at conclusions
# When disabled:
#   - Only shows final analysis without reasoning steps
#   - Faster response times
#   - Smaller response payloads
GEMINI_ENABLE_THINKING=true

# Deep Dive Threshold (Optional - defaults to 100 BTC)
# Minimum transaction size to offer Deep Dive analysis with Gemini Pro
# Deep Dive Features:
#   - Fetches blockchain history for source and destination addresses
#   - Analyzes last 10 transactions for each address
#   - Calculates 30-day volume and transaction patterns
#   - Detects accumulation, distribution, and mixing behaviors
#   - Identifies exchange flow direction (deposit/withdrawal)
#   - Provides comprehensive fund flow tracing
#   - Uses Gemini 2.5 Pro with 32K token limit
# Processing Time: 10-15 seconds (includes blockchain data fetch)
GEMINI_PRO_THRESHOLD_BTC=100

# API Performance Settings (Optional)
# Maximum retry attempts for failed API calls (default: 2)
# Retry Logic:
#   - Uses exponential backoff (1s, 2s, 4s)
#   - Only retries on retryable errors (429, 500, 502, 503, 504)
#   - Does not retry on client errors (400, 401, 403)
# Recommended: 2-3 retries for production
GEMINI_MAX_RETRIES=2

# Request timeout in milliseconds (default: 15000 = 15 seconds)
# Timeout Handling:
#   - Standard analysis: 15 seconds
#   - Deep Dive analysis: 30 seconds (automatically extended)
#   - On timeout: Returns partial analysis with disclaimer
# Recommended: 25000 for production (Vercel has 30s function limit)
# Note: Must be less than Vercel's maxDuration (30s) to prevent 504 errors
GEMINI_TIMEOUT_MS=25000

# Rate Limiting (Optional)
# Maximum requests per minute to Gemini API (default: 60)
# Gemini API Limits (as of January 2025):
#   - Free tier: 15 requests per minute
#   - Paid tier: 60 requests per minute
#   - Enterprise: Custom limits
# Note: Exceeding rate limits results in 429 errors with retry-after header
GEMINI_MAX_REQUESTS_PER_MINUTE=60

# Cost Management (Optional)
# Maximum output tokens for Flash model (default: 8192)
# Token Limits:
#   - Flash: 8,192 tokens (sufficient for standard analysis)
#   - Pro: 32,768 tokens (required for Deep Dive)
# Cost Impact:
#   - Lower values reduce cost but may truncate analysis
#   - Higher values increase cost but provide more detailed insights
# Recommended: 8192 for Flash, 32768 for Pro
GEMINI_FLASH_MAX_OUTPUT_TOKENS=8192

# Maximum output tokens for Pro model (default: 32768)
# Used for Deep Dive comprehensive analysis with blockchain data
# Includes: Address behavior, fund flow, historical patterns, market predictions
GEMINI_PRO_MAX_OUTPUT_TOKENS=32768

# Structured Output Validation (Automatic)
# The API automatically validates responses against JSON schema
# Validation includes:
#   - Required fields: transaction_type, market_impact, confidence, reasoning, key_findings, trader_action
#   - Confidence range: 0-100
#   - Minimum array lengths: key_findings (3-10 items)
#   - Minimum text lengths: reasoning (100+ chars), trader_action (50+ chars)
# Invalid responses are rejected with detailed error messages

# =============================================================================
# üì∞ NEWS API CONFIGURATION  
# =============================================================================
ALPHA_VANTAGE_API_KEY=your_alpha_vantage_key_here
NEWSAPI_KEY=your_newsapi_key_here

# =============================================================================
# üìä MARKET DATA CONFIGURATION
# =============================================================================
COINMARKETCAP_API_KEY=your_coinmarketcap_key_here
BINANCE_API_KEY=your_binance_api_key_here
BINANCE_SECRET_KEY=your_binance_secret_key_here

# =============================================================================
# üìß EMAIL CONFIGURATION (Office 365 / Microsoft Graph API)
# =============================================================================
# Email service for user notifications and authentication emails
# Uses existing Office 365 setup via Microsoft Graph API
# 
# Current Usage:
#   - Welcome emails after registration
#   - Password reset emails (coming soon)
#   - Security alerts (coming soon)
#   - Account notifications (coming soon)
# 
# Setup Instructions:
#   1. Ensure Office 365 tenant is configured
#   2. Verify Microsoft Graph API permissions
#   3. Use existing Azure AD app registration
#   4. Configure sender email as valid Office 365 mailbox
# 
# Documentation: 
#   - Microsoft Graph: https://docs.microsoft.com/en-us/graph/
#   - Office 365 Setup: See OFFICE-365-EMAIL-SETUP.md

# Email Sender Configuration (REQUIRED for welcome emails)
# Must be a valid mailbox in your Office 365 tenant
# Used for: Outbound authentication emails, welcome messages
# Format: Valid email address (e.g., no-reply@yourdomain.com)
# Example: no-reply@arcane.group
# 
# Requirements:
#   - Must exist as mailbox in Office 365
#   - Must have send permissions
#   - Should be a no-reply or system address
# 
# Note: This uses the existing Office 365 configuration
SENDER_EMAIL=no-reply@arcane.group

# Email Receiver Configuration (Optional)
# Used for: Contact form submissions, user inquiries, support requests
# Format: Valid email address for receiving messages
# Example: support@yourdomain.com
CONTACT_RECEIVER=support@arcane.group

# Azure AD Configuration (Uses existing Office 365 setup)
# These should already be configured for Office 365 email functionality
# Get credentials from: https://portal.azure.com

# Azure Tenant ID (Directory ID from Azure Portal)
# Format: UUID (e.g., c152592e-75fe-4f4f-8e8a-8acf38daf0b3)
# Location: Azure Portal > Azure Active Directory > Overview > Tenant ID
AZURE_TENANT_ID=your_azure_tenant_id_here

# Azure Client ID (Application ID from App Registration)
# Format: UUID (e.g., 83bcb34c-3c73-41e9-8dc8-94d257e8755c)
# Location: Azure Portal > App Registrations > Your App > Application (client) ID
AZURE_CLIENT_ID=your_azure_client_id_here

# Azure Client Secret (Generated secret from App Registration)
# Format: Secret string (e.g., F6U8Q~J-GFXtxSBWf5paE3jyIsGoir6rKAgTWbTp)
# Location: Azure Portal > App Registrations > Your App > Certificates & secrets
# Note: Keep this secret secure, rotate regularly (every 6-12 months)
AZURE_CLIENT_SECRET=your_azure_client_secret_here

# Email Feature Configuration (Optional)
# Control which email features are enabled

# Enable welcome emails after registration (default: true)
# Set to false to disable welcome emails
ENABLE_WELCOME_EMAIL=true

# Enable password reset emails (default: true)
# Coming soon - for password reset functionality
ENABLE_PASSWORD_RESET_EMAIL=true

# Enable security alert emails (default: true)
# Coming soon - for suspicious activity notifications
ENABLE_SECURITY_ALERT_EMAIL=true

# Alternative Email Providers (Optional - Not currently used)
# These are available for future implementation if needed

# SendGrid API Key (if using SendGrid instead of Office 365)
# Get from: https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=your_sendgrid_api_key_here

# SMTP Configuration (if using custom SMTP server)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your_smtp_username
SMTP_PASSWORD=your_smtp_password
SMTP_SECURE=true

# =============================================================================
# üîß APPLICATION CONFIGURATION
# =============================================================================
# Enable real-time data fetching
ENABLE_LIVE_DATA=true

# Next.js Configuration
NEXTAUTH_URL=https://your-domain.vercel.app
NEXTAUTH_SECRET=your_nextauth_secret_here

# =============================================================================
# üóÑÔ∏è DATABASE CONFIGURATION (Vercel Postgres)
# =============================================================================
# Vercel Postgres connection string for user authentication database
# Get from: Vercel Dashboard > Storage > Your Database > .env.local tab
# 
# Setup Instructions:
#   1. Go to Vercel Dashboard > Storage
#   2. Click "Create Database" > Select "Postgres"
#   3. Name: agents-md-auth-db (or your preferred name)
#   4. Region: Choose closest to your users (e.g., us-east-1)
#   5. Copy the DATABASE_URL from the .env.local tab
# 
# Format: postgres://default:password@host:5432/verceldb?sslmode=require
# Components:
#   - Protocol: postgres://
#   - User: default
#   - Password: [auto-generated secure password]
#   - Host: [your-instance].postgres.vercel-storage.com
#   - Port: 5432
#   - Database: verceldb
#   - SSL Mode: require (REQUIRED for security)
# 
# Security Notes:
#   - Never commit this to version control
#   - Store securely in password manager
#   - Rotate password if compromised
#   - Use different databases for dev/staging/production
# 
# Documentation: https://vercel.com/docs/storage/vercel-postgres
# Pricing: https://vercel.com/docs/storage/vercel-postgres/usage-and-pricing
DATABASE_URL=postgres://default:password@host.postgres.vercel-storage.com:5432/verceldb?sslmode=require

# =============================================================================
# üîê AUTHENTICATION CONFIGURATION
# =============================================================================

# JWT Secret for token signing (REQUIRED)
# Used to sign and verify JWT tokens for user sessions
# 
# Generation Instructions:
#   Method 1 (OpenSSL): openssl rand -base64 32
#   Method 2 (Node.js): node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
#   Method 3 (Online): https://generate-secret.vercel.app/32
# 
# Requirements:
#   - Minimum 256 bits (32 bytes)
#   - Cryptographically random
#   - Unique per environment (dev/staging/prod)
#   - Never reuse across projects
# 
# Security Notes:
#   - Keep this secret secure and never commit to version control
#   - Rotate every 6-12 months or immediately if compromised
#   - Use different secrets for dev/staging/production
#   - If changed, all existing sessions will be invalidated
# 
# Example (DO NOT USE THIS):
#   JWT_SECRET=dGhpc2lzYW5leGFtcGxlc2VjcmV0ZG9ub3R1c2U=
JWT_SECRET=your_jwt_secret_here

# JWT Token Expiration (Optional - defaults to 7 days)
# Controls how long users stay logged in
# 
# Format: Zeit/ms format
#   Examples: "7d" (7 days), "30d" (30 days), "24h" (24 hours), "60m" (60 minutes)
# 
# Usage:
#   - Standard session: 7d (7 days) - Default for normal login
#   - Remember me session: 30d (30 days) - When user checks "Remember Me"
#   - Short session: 24h (24 hours) - For high-security environments
# 
# Recommendations:
#   - Production: 7d (balances security and convenience)
#   - Development: 30d (reduces re-login frequency)
#   - High-security: 24h or less
# 
# Note: Users can extend to 30 days by checking "Remember Me" during login
JWT_EXPIRATION=7d

# JWT Remember Me Expiration (Optional - defaults to 30 days)
# Extended session duration when user checks "Remember Me"
# Format: Same as JWT_EXPIRATION
# Recommended: 30d (30 days)
JWT_REMEMBER_ME_EXPIRATION=30d

# =============================================================================
# üõ°Ô∏è RATE LIMITING CONFIGURATION (Vercel KV)
# =============================================================================
# Vercel KV (Redis) for distributed rate limiting
# Prevents brute force attacks and API abuse
# 
# Setup Instructions:
#   1. Go to Vercel Dashboard > Storage
#   2. Click "Create Database" > Select "KV"
#   3. Name: agents-md-rate-limit (or your preferred name)
#   4. Region: Same as Postgres for low latency
#   5. Copy all three KV variables from .env.local tab
# 
# Documentation: https://vercel.com/docs/storage/vercel-kv
# Pricing: https://vercel.com/docs/storage/vercel-kv/usage-and-pricing

# KV REST API URL (REQUIRED)
# Base URL for KV REST API
# Format: https://your-kv-instance.kv.vercel-storage.com
# Example: https://agents-md-rate-limit-abc123.kv.vercel-storage.com
KV_REST_API_URL=your_kv_rest_api_url_here

# KV REST API Token (REQUIRED)
# Read/Write token for setting and reading rate limit counters
# Used by: Login, registration, and other rate-limited endpoints
# Security: Keep secure, never commit to version control
KV_REST_API_TOKEN=your_kv_rest_api_token_here

# KV REST API Read-Only Token (Optional but recommended)
# Read-only token for checking rate limit status
# Used by: Monitoring and analytics endpoints
# Security: Less sensitive than write token, but still keep secure
KV_REST_API_READ_ONLY_TOKEN=your_kv_rest_api_read_only_token_here

# Rate Limiting Configuration (Optional)
# Fine-tune rate limiting behavior

# Maximum login attempts per email per window (default: 5)
# After this many failed attempts, user is temporarily blocked
# Recommended: 3-5 for production, 10 for development
# Too low: Legitimate users may be locked out
# Too high: Brute force attacks become easier
AUTH_RATE_LIMIT_MAX_ATTEMPTS=5

# Rate limit window in milliseconds (default: 900000 = 15 minutes)
# How long the rate limit counter persists
# Format: Milliseconds (900000 = 15 minutes, 3600000 = 1 hour)
# Recommended: 15 minutes (900000) for login attempts
# After this window, the counter resets automatically
AUTH_RATE_LIMIT_WINDOW_MS=900000

# Maximum registration attempts per IP per window (default: 5)
# Prevents automated account creation
# Recommended: 3-5 for production
AUTH_RATE_LIMIT_REGISTER_MAX_ATTEMPTS=5

# Registration rate limit window (default: 900000 = 15 minutes)
AUTH_RATE_LIMIT_REGISTER_WINDOW_MS=900000

# =============================================================================
# üîí CRON JOB SECURITY
# =============================================================================
# Secret token for authenticating cron job requests
# Prevents unauthorized execution of scheduled tasks
# 
# Generation Instructions:
#   Method 1 (OpenSSL): openssl rand -base64 32
#   Method 2 (Node.js): node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# 
# Used by:
#   - Session cleanup cron job (/api/cron/cleanup-sessions)
#   - Future scheduled tasks
# 
# Setup in Vercel:
#   1. Go to Project Settings > Cron Jobs
#   2. Add cron job with path: /api/cron/cleanup-sessions
#   3. Schedule: 0 2 * * * (Daily at 2 AM UTC)
#   4. Add header: Authorization: Bearer [Your CRON_SECRET]
# 
# Security Notes:
#   - Keep this secret secure and never commit to version control
#   - Rotate every 6-12 months
#   - Use different secrets for dev/staging/production
#   - If compromised, update immediately and redeploy
CRON_SECRET=your_cron_secret_here

# =============================================================================
# üîê SESSION MANAGEMENT CONFIGURATION
# =============================================================================

# Session Cleanup Configuration (Optional)
# Controls automatic cleanup of expired sessions

# Enable automatic session cleanup (default: true)
# Set to false to disable automatic cleanup
ENABLE_SESSION_CLEANUP=true

# Session cleanup interval in hours (default: 24)
# How often the cleanup cron job runs
# Recommended: 24 (daily cleanup)
SESSION_CLEANUP_INTERVAL_HOURS=24

# Session retention period in days (default: 30)
# How long to keep expired sessions before deletion
# Recommended: 30 days for audit purposes
SESSION_RETENTION_DAYS=30

# =============================================================================
# üîê ACCESS CONTROL CONFIGURATION (Legacy - Will be deprecated)
# =============================================================================
# Early Access Code (for password protection)
# Users can enter this code to bypass the access gate
# Format: Any string (case-insensitive)
# Example: BITCOIN2025, EARLYACCESS, SOVEREIGN
# Note: This will be replaced by database-backed authentication
# Status: DEPRECATED - Use database authentication instead
NEXT_PUBLIC_ACCESS_CODE=BITCOIN2025

# Email Sender Address (Office 365 mailbox)
# Must be a valid mailbox in your Office 365 tenant
# Used for sending access gate emails via Microsoft Graph API
SENDER_EMAIL=no-reply@arcane.group

# Email Feature Flags (Future Implementation)
# Enable email notifications for whale alerts
ENABLE_EMAIL_NOTIFICATIONS=false

# Enable contact form functionality
ENABLE_CONTACT_FORM=false

# Enable email alerts for trade signals
ENABLE_TRADE_ALERTS_EMAIL=false

# Enable daily market summary emails
ENABLE_DAILY_SUMMARY_EMAIL=false

# =============================================================================
# üöÄ DEPLOYMENT CONFIGURATION
# =============================================================================
NODE_ENV=production
VERCEL_ENV=production